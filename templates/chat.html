{% extends "base.html" %}

{% block title %}Chat - Núcleo 1.03{% endblock %}

{% set active_page = 'chat' %}

{% block content %}
<div class="flex h-screen">
    {% include "partials/sidebar.html" %}
    
    <main class="flex-1 flex flex-col overflow-hidden">
        <header class="glass-effect border-b border-dark-border/50 px-6 py-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                    <i class="fas fa-comments text-white"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">Mensagens</h2>
                    <p class="text-gray-400 text-sm">Comunicação interna</p>
                </div>
            </div>
        </header>
        
        <div class="flex-1 flex overflow-hidden">
            <div class="w-80 glass-effect border-r border-dark-border/50 overflow-y-auto">
                <div class="p-4 border-b border-dark-border/50">
                    <button onclick="abrirModalNovaConversa()" class="w-full btn-primary text-white py-2.5 px-4 rounded-xl flex items-center justify-center gap-2 font-medium mb-3">
                        <i class="fas fa-plus"></i>
                        Nova Conversa
                    </button>
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                        <input type="text" id="buscarConversa" class="w-full pl-10 pr-4 py-2.5 input-modern text-white rounded-xl text-sm" placeholder="Buscar conversa...">
                    </div>
                </div>
                <div id="listaConversas" class="divide-y divide-dark-border/30">
                    <div class="p-8 text-center">
                        <div class="w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"></div>
                        <p class="text-gray-400 text-sm">Carregando conversas...</p>
                    </div>
                </div>
            </div>
            
            <div class="flex-1 flex flex-col bg-dark-bg/50">
                <div id="cabecalhoChat" class="hidden glass-effect border-b border-dark-border/50 p-4">
                    <div class="flex items-center gap-3">
                        <img id="fotoDestinatario" class="w-10 h-10 rounded-full ring-2 ring-emerald-500/30" src="" alt="">
                        <div>
                            <h3 id="nomeDestinatario" class="text-white font-semibold"></h3>
                            <p id="emailDestinatario" class="text-gray-400 text-sm"></p>
                        </div>
                    </div>
                </div>
                
                <div class="flex-1 overflow-y-auto p-6" id="areaMensagens">
                    <div class="h-full flex flex-col items-center justify-center text-gray-400">
                        <div class="w-20 h-20 rounded-2xl bg-dark-card flex items-center justify-center mb-4">
                            <i class="fas fa-comments text-3xl text-gray-600"></i>
                        </div>
                        <p class="text-lg font-medium">Selecione uma conversa</p>
                        <p class="text-sm text-gray-500">Escolha um contato para começar</p>
                    </div>
                </div>
                
                <div id="formularioMensagem" class="hidden glass-effect border-t border-dark-border/50 p-4">
                    <div class="flex gap-3">
                        <textarea id="inputMensagem" class="flex-1 px-4 py-3 input-modern text-white rounded-xl resize-none" rows="2" placeholder="Digite sua mensagem..."></textarea>
                        <button onclick="enviarMensagem()" class="btn-primary text-white px-6 rounded-xl flex items-center justify-center">
                            <i class="fas fa-paper-plane text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="modalNovaConversa" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
    <div class="glass-effect rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col animate-slide-up">
        <div class="p-6 border-b border-dark-border/50 flex justify-between items-center">
            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                <i class="fas fa-user-plus text-emerald-400"></i>
                Iniciar Nova Conversa
            </h3>
            <button onclick="fecharModalNovaConversa()" class="w-8 h-8 rounded-lg bg-dark-card hover:bg-dark-hover flex items-center justify-center text-gray-400 hover:text-white transition">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="p-6 overflow-y-auto flex-1">
            <div class="relative mb-4">
                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="buscarConsultorModal" class="w-full pl-10 pr-4 py-3 input-modern text-white rounded-xl" placeholder="Buscar por nome ou email...">
            </div>
            <div id="listaConsultoresModal" class="space-y-2">
                <div class="text-center py-8">
                    <div class="w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
                </div>
            </div>
        </div>
        
        <div class="p-6 border-t border-dark-border/50">
            <button onclick="fecharModalNovaConversa()" class="w-full px-4 py-3 bg-dark-card hover:bg-dark-hover text-gray-300 rounded-xl font-medium transition">
                Cancelar
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/chat.js"></script>
{% endblock %}
